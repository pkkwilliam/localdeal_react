(this.webpackJsonplocal_deal=this.webpackJsonplocal_deal||[]).push([[4],{129:function(e,t,n){"use strict";n.r(t);var a=n(21),r=n.n(a),o=n(4),i=n(5),s=n(7),l=n(6),c=n(8),d=n(0),u=n.n(d),p=n(17),m=n(11),g=n(13),h=n(171),f=n(172),C=n(28),b=Object(C.a)(u.a.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),v=Object(C.a)(u.a.createElement("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"}),"FolderOpen"),S=Object(C.a)(u.a.createElement("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"}),"HelpOutline"),y=Object(C.a)(u.a.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete"),E=n(175),D=n(64),x=function(e){function t(){var e,n,a=this;Object(o.a)(this,t);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return(n=Object(s.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(i)))).AddImageButton=function(){return u.a.createElement(a.Frame,null,u.a.createElement("input",{accept:"image/*",onChange:function(e){return n.props.onAddFile(e)},style:{display:"none"},id:"raised-button-file",multiple:!0,type:"file"}),u.a.createElement("label",{htmlFor:"raised-button-file"},u.a.createElement(E.a,{component:"span",style:A.addIconButton},u.a.createElement(h.a,{scale:"big",style:A.addIcon}))))},n.AddressSelection=function(){var e=n.props.selectedAddress?u.a.createElement(a.SelectedAddress,null):u.a.createElement(a.AddressBubble,null);return u.a.createElement(u.a.Fragment,null,u.a.createElement(a.MissingSectionLabel,{hide:n.props.hasAddress,label:n.appContext.labels.createDealPageV2.missingAddress}),u.a.createElement(g.n,{isFlexDirectionRow:!0,style:A.addressSectionContainer},u.a.createElement(f.a,{style:A.locationIcon}),e))},n.AddressBubble=function(){var e=n.appState.address.addressesPrediction.map((function(e){return u.a.createElement(g.n,{border:1,onClick:function(){return n.props.onClickAddress(e)},style:Object(m.a)({},A.addressBubbleContainer,{whiteSpace:"nowrap"})},u.a.createElement(g.j,{style:{color:g.o.color.secondaryColor}},e.formattedAddress))}));return u.a.createElement(g.n,{isFlexDirectionRow:!0,style:A.addressSelectionContainer},e)},n.BottomButtonSecton=function(){return u.a.createElement(g.n,{isFlexDirectionRow:!0,style:A.bottomButtonSectionContainer},u.a.createElement(a.DraftButton,null),u.a.createElement(a.SubmitButton,null))},n.CloseButton=function(){return u.a.createElement(b,{onClick:n.props.onClose,style:A.closeIcon})},n.Description=function(){return u.a.createElement(D.a,{multiline:!0,onChange:n.props.onChangeDescription,placeholder:n.appContext.labels.createDealPageV2.descriptionPlaceHolder,rows:6})},n.DraftButton=function(){return u.a.createElement(E.a,{onClick:n.props.onClickSaveDraft,style:A.draftButton},u.a.createElement(g.n,{style:A.draftButtonContainer},u.a.createElement(v,{style:A.draftIcon}),u.a.createElement(g.i,{color:"secondary"},n.appContext.labels.createDealPageV2.saveDraft)))},n.FileSection=function(){var e=n.props.files.map((function(e){return u.a.createElement(a.ImageContainer,{image:e})}));return n.props.files.length<n.props.allowNumberOfFile&&e.push(u.a.createElement(a.AddImageButton,null)),u.a.createElement(u.a.Fragment,null,u.a.createElement(a.MissingSectionLabel,{hide:n.props.hasField,label:n.appContext.labels.createDealPageV2.missingField}),u.a.createElement(g.n,{isFlexDirectionRow:!0,style:A.fileSectionContainer},e))},n.Header=function(){return u.a.createElement(g.n,{isFlexDirectionRow:!0,style:A.headerContainer},u.a.createElement(a.ImageDimensionTips,null),u.a.createElement(a.CloseButton,null))},n.ImageContainer=function(e){var t=e.image;return u.a.createElement(a.Frame,null,u.a.createElement("img",{alt:"user-input",src:t.base64Value,style:Object(m.a)({},A.imageStyle,{objectFit:"cover"})}))},n.ImageDimensionTips=function(){return u.a.createElement(g.n,{isFlexDirectionRow:!0,style:A.imageDimensionTipsContainer},u.a.createElement(S,{style:A.imageDimensionTipsIcon}),u.a.createElement(g.g,null,n.appContext.labels.createDealPageV2.imageDimensionTips))},n.Frame=function(e){var t=e.children;return u.a.createElement(g.n,{border:1,style:A.frameContainer},t)},n.MissingSectionLabel=function(e){var t=e.label;return e.hide?null:u.a.createElement(g.j,{style:{color:"red",fontWeight:"bold"}},t)},n.SelectedAddress=function(){var e,t;return u.a.createElement(g.n,{isFlexDirectionRow:!0,style:A.selectedAddressContainer},u.a.createElement(g.j,{style:A.selectedAddressText},null!==(e=null===(t=n.props.selectedAddress)||void 0===t?void 0:t.formattedAddress)&&void 0!==e?e:""),u.a.createElement(y,{onClick:n.props.onClickRemoveSelectedAddress,style:A.deleteIcon}))},n.SubmitButton=function(){return u.a.createElement(g.k,{onClick:n.props.onClickSubmit},n.appContext.labels.createDealPageV2.submitPost)},n.Title=function(){return u.a.createElement(D.a,{onChange:n.props.onChangeTitle,placeholder:n.appContext.labels.createDealPageV2.titlePlaceHolder})},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return u.a.createElement(g.n,{style:A.rootContainer},u.a.createElement(this.Header,null),u.a.createElement(this.FileSection,null),u.a.createElement(this.Title,null),u.a.createElement(this.Description,null),u.a.createElement(this.AddressSelection,null),u.a.createElement(this.BottomButtonSecton,null))}}]),t}(p.a),A={addIcon:{color:g.o.color.greyTransparent,fontSize:"80"},addIconButton:{borderRadius:10},addressBubbleContainer:{borderColor:g.o.color.secondaryColor,borderRadius:30,paddingTop:2,paddingBottom:2,paddingLeft:10,paddingRight:10,marginRight:5},addressSelectionContainer:{overflow:"scroll",paddingBottom:10},addressSectionContainer:{alignItems:"center",marginTop:5,width:"inherit"},bottomButtonSectionContainer:{alignItems:"center",justifyContent:"center",marginBottom:20,marginTop:20,width:"inherit"},closeIcon:{color:g.o.color.greyDark},deleteIcon:{color:g.o.color.greyDark},descriptionTextField:{marginTop:10,width:"inherit"},draftButton:{padding:0},draftButtonContainer:{alignItems:"center",justifyContent:"center"},draftIcon:{backgroundColor:g.o.color.secondaryColorTransparent,borderRadius:25,color:g.o.color.secondaryColor,fontSize:16,marginBottom:1,padding:3},fileSectionContainer:{alignItems:"start",overflow:"scroll",paddingBottom:10,paddingTop:10,width:"inherit"},frameContainer:{alignItems:"center",borderColor:g.o.color.greyTransparent,borderRadius:10,justifyContent:"center",margin:5,maxHeight:80,maxWidth:80,minHeight:80,minWidth:80},headerContainer:{alignItems:"center",justifyContent:"space-between",marginTop:15,width:"inherit"},imageDimensionTipsContainer:{alignItems:"center",justifyContent:"center"},imageDimensionTipsIcon:{color:g.o.color.secondaryColor,fontSize:18},imageStyle:{borderRadius:10,minHeight:"inherit",minWidth:"inherit"},locationIcon:{color:g.o.color.red,marginLeft:-5,marginRight:3,paddingBottom:10},rootContainer:{width:"inherit"},selectedAddressContainer:{alignItems:"center",justifyContent:"space-between",paddingBottom:10,width:"inherit"},selectedAddressText:{color:g.o.color.black},titleTextField:{marginTop:10,width:"inherit"}},w=n(29);n.d(t,"default",(function(){return k}));var k=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e))).onAddFile=function(e){console.debug("onAddImage");var t=e.target.files;if(null!==t)for(var a=0;a<t.length;a++)n.convertImageToBase64(t[a])},n.onChangeDescription=function(e){console.debug("onChangeDescription"),n.setState({description:e})},n.onChangeTitle=function(e){console.debug("onChangeTitle"),n.setState({title:e})},n.onClickAddress=function(e){console.debug("onClickAddress"),n.setState({selectedAddress:e})},n.onClickRemoveSelectedAddress=function(){console.debug("onClickRemoveSelectedAddress"),n.setState({selectedAddress:void 0})},n.onClickSaveDraft=function(){console.debug("onClickSaveDraft")},n.onClickSubmit=function(){return r.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:console.debug("onClickSubmit"),n.verifyInput()&&n.onSubmit();case 2:case"end":return e.stop()}}))},n.onSubmit=function(){var e,t,a,o;return r.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return console.debug("start to submit a new deal"),i.next=3,r.a.awrap(n.appState.createDeal.setCreateDealUploading(!0));case 3:return n.props.onClose(),t=n.appContext.labels.createDealPageV2,i.next=7,r.a.awrap(n.appState.createDeal.setCreateDealProgressMessage(t.uploadingImage));case 7:return i.next=9,r.a.awrap(Promise.all(n.state.files.map((function(e){var t,a,o;return r.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.a.awrap(n.imageProcessor.imagePrecprocess(e.base64Value));case 2:return a=i.sent,i.next=5,r.a.awrap(n.appContext.serviceExecutor.execute(Object(w.e)(e.type,e.name)));case 5:return o=i.sent,i.next=8,r.a.awrap(n.appContext.serviceExecutor.execute(Object(w.j)(a,null!==(t=o.preSignedUrl)&&void 0!==t?t:"")));case 8:return i.abrupt("return",o.url);case 9:case"end":return i.stop()}}))}))).then((function(e){return e})));case 9:return a=i.sent,i.next=12,r.a.awrap(n.appState.createDeal.setCreateDealProgressMessage(t.uploadingDeal));case 12:return o={address:n.state.selectedAddress,description:n.state.description,filesUrl:a.map((function(e){return null!==e&&void 0!==e?e:""})),serverIdentifierName:null===(e=n.state.selectedAddress)||void 0===e?void 0:e.area,timestamp:0,title:n.state.title},i.next=15,r.a.awrap(n.appContext.serviceExecutor.execute(Object(w.a)(o)));case 15:if(!n.state.selectedAddress){i.next=18;break}return i.next=18,r.a.awrap(n.appContext.serviceExecutor.execute(Object(w.d)(n.state.selectedAddress)).then((function(e){n.appState.deal.setDeals(e.deals)})).then((function(){setTimeout((function(){n.appState.createDeal.setCreateDealUploading(!1)}),5e3)})).catch((function(){console.debug("something weng wrong while creating deal")})));case 18:return i.next=20,r.a.awrap(n.appState.createDeal.setCreateDealProgressMessage(t.uploadCompleted));case 20:case"end":return i.stop()}}))},n.state={files:[],blobFiles:[],description:"",hasAddress:!0,hasField:!0,title:""},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return u.a.createElement(x,{allowNumberOfFile:9,files:this.state.files,onAddFile:this.onAddFile,onChangeDescription:this.onChangeDescription,onChangeTitle:this.onChangeTitle,onClickAddress:this.onClickAddress,onClickRemoveSelectedAddress:this.onClickRemoveSelectedAddress,onClickSaveDraft:this.onClickSaveDraft,onClickSubmit:this.onClickSubmit,onClose:this.props.onClose,hasAddress:this.state.hasAddress,hasField:this.state.hasField,selectedAddress:this.state.selectedAddress})}},{key:"convertImageToBase64",value:function(e){var t,n=this;return r.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:(t=new FileReader).onload=function(t){t.target&&t.target.result&&n.imageProcessor.fixRotation(t.target.result.toString()).then((function(t){n.setState({files:n.state.files.concat({base64Value:t,name:e.name,type:e.type})})}))},t.readAsDataURL(e);case 3:case"end":return a.stop()}}))}},{key:"verifyInput",value:function(){var e=this.state,t=void 0!==e.selectedAddress,n=""!==e.title||""!==e.description||e.files.length>0;return this.setState({hasAddress:t,hasField:n}),t&&n}}]),t}(p.a)}}]);
//# sourceMappingURL=4.706472e8.chunk.js.map